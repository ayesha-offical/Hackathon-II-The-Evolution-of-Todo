# Contributing Guidelines

**Task**: T013 | **Spec**: @specs/001-sdd-initialization/ | **Constitution**: VI (No Manual Coding Rule)

## Overview

This project follows **Spec-Driven Development (SDD)** principles. All code must be generated by AI agents following this strict workflow:

```
Specify (Requirements) → Plan (Architecture) → Tasks (Breakdown) → Implement (Code)
```

## Core Rules

### ✅ MUST DO:

1. **Every Code Change Requires a Task ID**
   - No code is written without a referenced Task ID
   - Task IDs come from `/specs/[feature]/tasks.md`
   - Format: `# Task: T042 | Spec: @specs/features/task-crud.md`

2. **Code Comments Include Spec References**
   ```python
   # Task: T042 | Spec: @specs/001-sdd-initialization/features/task-crud.md
   # Purpose: Implement task creation endpoint (FR-001)
   ```

3. **Git Commits Reference Task IDs**
   ```bash
   git commit -m "feat(T042): Implement task creation endpoint

   Co-Authored-By: Claude Haiku 4.5 <noreply@anthropic.com>"
   ```

4. **Constitution Principles Are Non-Negotiable**
   - **Constitution II**: JWT middleware validates all `/api/**` requests
   - **Constitution III**: Every query filters by `user_id` from JWT
   - **Constitution IV**: No hardcoded secrets (use environment variables)
   - **Constitution V**: Proper HTTP status codes (401, 403, 404, etc.)
   - **Constitution VI**: All code is AI-generated with Task ID references

### ❌ MUST NOT:

- Write code without a Task ID from tasks.md
- Hardcode secrets or environment-dependent values
- Commit code with console.log/print statements
- Store JWT tokens in localStorage (use HTTP-only cookies only)
- Bypass JWT verification for any protected endpoint
- Write database queries that don't filter by `user_id`
- Manual code modifications without AI agent co-authorship

## Development Workflow

### 1. Create Feature Specification

Before implementing any feature:
1. Create `/specs/[feature]/spec.md` with requirements
2. Run `/sp.specify` to validate specification quality
3. Get explicit user approval before proceeding

### 2. Design Architecture

Create `/specs/[feature]/plan.md` including:
- Technical stack decisions
- Component breakdown
- Service boundaries
- Data model
- API endpoints

### 3. Generate Tasks

Run `/sp.tasks` to break architecture into atomic tasks:
- Each task is independently testable
- Task IDs are sequential (T001, T002, ...)
- Tasks link back to specific requirements

### 4. Implement Tasks

Execute tasks **in order**:
- Phase 1: Setup (project structure, dependencies)
- Phase 2: Foundation (database, middleware, base configuration)
- Phase 3+: Feature implementation (grouped by user story)

## Code Organization

### Backend (`backend/`)

```
backend/
├── src/
│   ├── main.py              # FastAPI app entry point (Task ID comment required)
│   ├── config.py            # Environment configuration (Pydantic BaseSettings)
│   ├── middleware/          # JWT verification, CORS, logging
│   ├── models/              # SQLModel entity definitions
│   ├── schemas/             # Pydantic request/response validation
│   ├── services/            # Business logic (receives user_id as parameter)
│   ├── api/v1/              # Route handlers (extract user_id from JWT)
│   └── db/                  # Database engine and session management
├── alembic/                 # Database migrations
├── tests/                   # Test files
└── pyproject.toml          # Dependencies and ruff configuration
```

### Frontend (`frontend/`)

```
frontend/
├── src/
│   ├── app/                 # Next.js App Router
│   │   ├── login/           # Login page
│   │   ├── dashboard/       # Protected dashboard
│   │   └── tasks/           # Task management pages
│   ├── components/          # Reusable React components
│   ├── lib/                 # Utilities (API wrapper, auth, helpers)
│   ├── contexts/            # React contexts (AuthContext)
│   ├── types/               # TypeScript interfaces
│   └── config/              # Configuration (constants, API endpoints)
├── tests/                   # Test files
└── package.json            # Dependencies and scripts
```

## Security Checklist

- [ ] All `/api/**` endpoints have JWT middleware
- [ ] All authenticated endpoints use `Depends(get_current_user_id)`
- [ ] All database queries include `WHERE user_id = <extracted_id>`
- [ ] No JWT tokens in response bodies (HTTP-only cookies only)
- [ ] No hardcoded secrets in code
- [ ] No console.log/print statements in production code
- [ ] All errors return proper HTTP status codes (401, 403, 404, etc.)
- [ ] Environment variables loaded from .env.local (development) or env vars (production)

## Testing Requirements

Each Task may include test tasks:
- Write tests BEFORE implementing features (TDD approach)
- Tests must verify acceptance criteria from spec.md
- Test coverage for user isolation (User A ≠ User B data)
- Integration tests for complete user journeys

## Code Quality

### Formatting

**Python** (backend): Use `ruff` formatter configured in `pyproject.toml`
```bash
cd backend
ruff format .
ruff check . --fix
```

**JavaScript/TypeScript** (frontend): Use ESLint + Prettier
```bash
cd frontend
npm run lint -- --fix
npm run format
```

### Pre-commit Checklist

Before committing:
- [ ] Code runs without errors
- [ ] Linter passes (ruff for Python, ESLint for JS)
- [ ] Task ID referenced in all comments
- [ ] No hardcoded secrets
- [ ] No console.log/print statements
- [ ] Constitution principles enforced

## Commit Message Format

```
feat(T042): Implement task creation endpoint

- Create POST /api/v1/tasks endpoint
- Enforce user_id from JWT (Constitution III)
- Return 201 Created on success
- Return 400 Bad Request if validation fails

Closes: #123
Co-Authored-By: Claude Haiku 4.5 <noreply@anthropic.com>
```

**Format**:
1. Type: `feat`, `fix`, `docs`, `test`, `refactor`, `style`, `chore`
2. Task ID: `(T042)`
3. Title: Clear, concise description
4. Body: Implementation details (optional)
5. Co-author line: Required for all code

## Troubleshooting

### "Cannot find task.md"

Run `/sp.tasks` to generate from `spec.md` and `plan.md`:
```bash
cd /path/to/feature
/sp.tasks
```

### "Task ID T042 not found"

Ensure you're referencing the correct feature directory:
- Features live in `/specs/[feature-name]/`
- Tasks live in `/specs/[feature-name]/tasks.md`

### "Need to modify existing code without Task ID"

Create a **new task** for the modification:
1. Add task to `tasks.md` with new ID
2. Document the reason in commit message
3. Include `Co-Authored-By` line

## Questions?

Refer to:
1. `.specify/memory/constitution.md` - Core principles
2. `specs/001-sdd-initialization/` - Initial feature specifications
3. `specs/001-sdd-initialization/plan.md` - Architecture decisions

---

**Version**: 1.0.0
**Last Updated**: 2026-01-23
**Status**: Active (SDD Enforcement)
